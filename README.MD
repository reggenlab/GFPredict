## Introduction[![](./extras/images/pin.svg)](#introduction)

**GFPredict** is a R package. It predicts coding and non-coding genes related to (user input) gene-sets. GFPredict compares the similarity between the epigenomic and transcription factor binding patterns at the promoter sites of the input genes and other genes, to make predictions. [Click here](https://www.biorxiv.org/content/10.1101/2022.04.17.488570v1) to learn more about GFPredict.

---

## Table of contents[![](./extras/images/pin.svg)](#table-of-contents)
1. [GFPredict Package installation](#installation)

2. [GFPredict usage examples](#examples)

3. [Generate results used in the analyses of the paper](#results)
   - [A. Results of random forest algorithm for 295 ontological gene-sets](#ontology_results)
   - [B. PUBMED-based abstract mining](#pubmed_abtract_mining)
   - [C. Clustering of functions](#function_cluster)
   - [D. Validation of predicted lncRNAs in clusters using CRISPR screens](#cluster_crispr_screen)
   - [E. GFPredict testing using different CRISPR screens](#different_crispr_screen)


---

## 1. GFPredict Package installation[![](./extras/images/pin.svg)]<a name="installation"></a>

### Download zip file and install the package (recommended):

**Step 1.** Download zip file.

```shell
wget https://github.com/reggenlab/GFPredict/archive/refs/heads/main.zip

```
**Step 2.** Install the package in R session.

```r
devtools::install_local('main.zip')

```

### Or install through R commands.


``` r
options(timeout=9999999)
devtools::install_github("reggenlab/GFPredict")
```

In case of difficulty in installation of libraries,"randomForest", "xgboost" or "glmnet", run the following commands:
``` r
packageurl_xgboost <- "http://cran.r-project.org/src/contrib/Archive/xgboost/xgboost_0.90.0.2.tar.gz"
install.packages(packageurl_xgboost, repos=NULL, type="source") #for xgboost

install_version("glmnet", version = "3.0-2") #https://cran.r-project.org/src/contrib/Archive/glmnet/ 

packageurl_rf <- "https://cran.r-project.org/src/contrib/Archive/randomForest/randomForest_4.6-12.tar.gz"
install.packages(packageurl_rf, repos=NULL, type="source") 

```

---

## 2. GFPredict usage examples [![](./extras/images/pin.svg)]<a name="examples"></a>

After the installation:

``` r
library(GFPredict)

cell_cycle_related_genes <- c("RPL23A", "IPO4", "TARS1", "COG4", "TEX10", "TRMT112", "TXNL4A", "CLP1", 
"HSPA5", "ANAPC4", "RNF168", "ATP5F1D", "RUVBL2", "NMT1", "PNKP", "SF3B3", "FDPS", "FARSB", "HARS1",
"RPL8", "CCT3", "AQR", "MCL1", "CENPM")

result <- predict_related_genes(cell_cycle_related_genes) #Default parameter are selected

#Fine tune the model by changing the number of bootstraps of the negative set
result <- predict_related_genes(genes = cell_cycle_related_genes, n_bootstrap = 5)

#Use different ML algorithm if the model performance is not good after using the default random forest algoritm 
result <- predict_related_genes(genes = cell_cycle_related_genes, ml_model = 'svm', n_bootstrap = 10, feature_type = 'transcription_factors')

result[[1]] # contains list of predicted genes 

result[[2]] # contains table of model performance metrics 

result[[3]] # contains table of top predictors (if ml_model = random.forest)

```

---

## 3. Generate results used in the analyses of the paper [![](./extras/images/pin.svg)] <a name="results"></a>

Run the following scrips to reproduce the results showed in the [paper](https://www.biorxiv.org/content/10.1101/2022.04.17.488570v1)

### A. Generateing results of random forest algorithm for 295 ontological gene-sets in **3 steps:** <a name="ontology_results"></a>

**Step 1.** Clone the GitHub repository. <a name="clone"></a> 

```shell
#script
git clone https://github.com/reggenlab/GFPredict.git

```
**Step 2.** Run the below two commands and the output results will be saved inside directory '/3'. ***Make sure following R packages are installed:***

*  "ggplot2"
*  "randomForest" 
*  "glmnet"
*  "ROCR"
*  "xgboost"
*  "mltest"
*  "SHAPforxgboost"

**Note: It will take up to 30 minutes to completely run the code, check the progress opening functionalML.Rout file**


```shell
#move to the directory condtaining R script
cd GFPredict/code/

#run the script functionML.R.
nohup R CMD BATCH '--args  starti=1 endi=295  MLmodel=3  outf="rf_result/f-1-295.txt" TPRf="rf_result/TPR-1-295.txt" FDRf="rf_result/FDR-1-295.txt" predf="rf_result/pred-1-295.txt" toptf="rf_result/tfs-1-295.txt"  cfmtx="rf_result/cf-1-295.txt" '  functionalML.R  &

```
**Step 3.** Note that the input files (pred_scores*.csv) are hard-coding into the script.
If you wish to change the input file generated by above step, edit the script to read the file, "/rf_result/pred-1-295.txt".


```shell

#run this to get final predicted genes inside directory 'GFPredict/code/'.
python3 calculate_tpr_predict_genes.py

```

The output file 'predicted_genes.csv' will contain predicted genes for all the 295 gene-sets. Each row is a gene-set, corresponding columns contains predicted genes along with confidence score/tpr score

---


### B. PUBMED-based abstract mining <a name="pubmed_abtract_mining"></a>

For the predicted genes of 295 functions (file can also be found at ../data/predicted_genes.csv) of random forest model,
run pubmed-based abstract mining and plot the number of occurrences of predicted gene terms and corresponding function terms.

**Note:** Path inside the script for the input file is set to '../data/predicted_genes.csv', you can give your own result file obtained after section 3A. 

Clone the document using command from [3A.](#clone) and run the below commands.

***Step 1.*** Run abtract mining using Bio-Entrez library in python
```shell
#move to the directory containing script: pubmed_abtract_mining.py 
cd GFPredict/code/

#Run the script, can take up to 30-120 minutes depending on the NCBI's server 
python3 pubmed_abtract_mining.py

```
***Step 2.*** Run the R script to plot the obtained data. Data is present at GFPredict/data/ 
Or use data generated in the above step by editing the path in the script
```shell
Rscript plot_abtract_mining_results.R

```


---


### C. Clustering of functions <a name="function_cluster"></a>

**Note:** R package 'Rtsne' and  'factoextra' must be installed to run this code.

Clone the document using command from [3A.](#clone).
Run the below code to get plot of clusters of functions based on shared top predictors.

```shell
#move to the directory containing script: clustering_functions.R
cd GFPredict/code/

#Run the below line
Rscript clustering_functions.R
```
---

### D. Validation of predicted lncRNAs in clusters using CRISPR screens <a name="cluster_crispr_screen"></a>

Clone the document using command from [3A.](#clone).

```shell
#move to directory containing script: lncrna_crispr_validation.R
cd GFPredict/code/

#Run the below line, two PDF files with bar plots will be generated
Rscript lncrna_crispr_validation.R

```

### D. GFPredict testing using different CRISPR screens <a name="different_crispr_screen"></a>

Clone the document using command from [3A.](#clone) and run the below command.

``` shell
#The outputs will be PDFs containg barplots
Rscript package_test_crispr.R 

```
<!-- markdownlint-enable -->
